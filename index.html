<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Preview</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: black;
      }
      .title,
      .name_channel,
      .mc_elm {
        font-family: "Anton", sans-serif;
      }
      .segment.highlight {
        background-color: #adb5bd;
        color: black;
        padding: 0.1em 0.25em;
        border-radius: 4px;
      }
      .segment {
        display: block; /* Cho mỗi span xuống dòng */
        margin-bottom: 0.5em; /* Cách dòng */
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Anton&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="">
    <!-- Preview Container (scaled down to 1280x720) -->
    <div
      class="relative w-[1280px] h-[720px] overflow-hidden font-sans text-white origin-top-left"
    >
      <!-- Nền ảnh -->
      <img
        src="{{background_url}}"
        class="absolute w-full h-full object-cover z-0 brightness-50"
        alt="background"
      />

      <!-- Overlay nội dung -->
      <div class="relative z-10 flex flex-col h-full p-6">
        <!-- Header -->
        <div class="flex flex-col items-start mt-4">
          <div class="title text-4xl flex justify-between gap-4">
            <span id="title"></span> <span class="flex gap-4">Chương <span id="chapter_from"></span> - <span id="chapter_to"></span></span> 
          </div>
          <div class="text-lg text-gray-300"><span id="tags"></span></div>
        </div>

        <!-- Main content -->
        <div class="mt-4">
          <div class="h-[480px] flex flex-1 gap-4">
            <!-- Text area -->
            <div
              id="scrolling"
              class="max-h-[480px] w-[925px] text-[#111827] bg-[#fefae0] rounded-lg p-4 leading-relaxed shadow-lg space-y-2 border-4 border-white text-4xl overflow-y-auto"
            >
              {{LINES}}
            </div>

            <!-- MC Video/avatar -->
            <div class="flex flex-col gap-4 items-center">
              <div class="flex justify-betwen gap-4">
                <img
                  src="{{channel_avatar_url}}"
                  alt="Avatar"
                  class="w-28 h-28 rounded-full object-cover border-4 border-white shadow-lg"
                />
                <div class="flex flex-col justify-center">
                  <span class="name_channel text-xl" id="channel_name"></span>
                  <span class="name_a_channel text-sm" id="channel_id"></span>
                  <span class="sub_channel text-sm" id="channel_subs"></span>
                </div>
              </div>
              <div
                class="flex flex-1 justify-center items-center w-full relative"
              >
                <div
                  class="w-full h-full overflow-hidden shadow-xl border-4 border-white"
                ></div>
                <div
                  class="mc_elm absolute bottom-[4px] z-10 bg-red-500 w-[calc(100%-8px)] text-center text-xl py-2"
                >
                  <span id="mc_name"></span>
                </div>
              </div>
            </div>
          </div>
          <div
            class="w-full h-[50px] my-4 bg-black bg-opacity-50 text-[24px]"
          ></div>
        </div>
      </div>
    </div>
    <script>
      window.__readyToCapture = new Promise((resolve) => {
        window.__resolveCapture = resolve;
      });

      function highlight(index) {
        const segments = document.querySelectorAll(".segment");
        segments.forEach((el, i) => {
          const isEmpty = el.textContent.trim() === "";
          el.classList.toggle("highlight", i === index && !isEmpty);
        });

        const target = segments[index];
        if (target) {
          target.scrollIntoView({
            behavior: "instant",
            block: "center",
          });
        }

        if (window.__resolveCapture) {
          requestAnimationFrame(() => {
            setTimeout(() => {
              window.__resolveCapture();
            }, 150);
          });
        }
      }
    </script>
    <script>
      const params = new URLSearchParams(window.location.search);

      document.getElementById("title").textContent =
        params.get("title") || "Tiêu đề mặc định";
      document.getElementById("chapter_from").textContent =
        params.get("chapter_from") || "1";
      document.getElementById("chapter_to").textContent =
        params.get("chapter_to") || "10";
      document.querySelector(".text-lg").textContent =
        params.get("tags") || "tag1, tag2";

      document.getElementById("scrolling").innerHTML = (
        params.get("lines") || "Nội dung mặc định"
      )
        .split("\n")
        .map((line) => `<span class="segment">${line}</span>`)
        .join("");

      document.querySelector(".mc_elm").textContent =
        params.get("mc_name") || "MC Nặc Danh";
      document.querySelector(".name_channel").textContent =
        params.get("channel_name") || "Tên kênh";
      document.querySelector(".name_a_channel").textContent =
        params.get("channel_id") || "@kenh_id";
      document.querySelector(".sub_channel").textContent =
        params.get("channel_subs") || "100K người đăng ký";
      document.querySelector("img[alt='Avatar']").src =
        params.get("channel_avatar_url") || "https://via.placeholder.com/100";
      document.querySelector("img[alt='background']").src =
        params.get("background_url") || "https://via.placeholder.com/1280x720";
    </script>
  </body>
</html>
